from openai import OpenAI
import httpx
import json
import time
from time import sleep
from painting import painting_from_list

client = OpenAI(
    base_url="https://api.xiaoai.plus/v1",
    api_key="sk-YMrZo7k1RTpVdNOa7eDb12319dB7471fB841F5Dc2c49Df3e",
    http_client=httpx.Client( base_url="https://api.xiaoai.plus/v1", follow_redirects=True,),
)

E2G_prompt = '''
# You are a text Question-Answer agent. Given a claim to answer and a collection of potentially useful context about the claim.
# The format of each piece of context: {"idx":[context index], "title":[title of the context], "paragraph_text":[content of the context]}
#  Think step by step with evidence and explanation.
#  Generate both answer and step-by-step-reasoning-with-evidence-and-explanation 

Question: Which Australian city founded in 1838 contains a boarding school opened by a Prime Minister of Australia and named after a school in London of the same name.
Supporting Contexts: {"idx": 0, "title": "Janet Waldo", "paragraph_text": "Janet Marie Waldo (February 4, 1920 \u2013 June 12, 2016) was an American radio and voice actress. She is best known in animation for voicing Judy Jetson, Nancy in \"Shazzan\", Penelope Pitstop, and Josie in \"Josie and the Pussycats\", and on radio as the title character in \"Meet Corliss Archer\"."}, {"idx": 1, "title": "Meet Corliss Archer (TV series)", "paragraph_text": "Meet Corliss Archer is an American television sitcom that aired on CBS (July 13, 1951 - August 10, 1951) and in syndication via the Ziv Company from April to December 1954. The program was an adaptation of the radio series of the same name, which was based on a series of short stories by F. Hugh Herbert."}, {"idx": 2, "title": "Village accountant", "paragraph_text": "The Village Accountant (variously known as \"Patwari\", \"Talati\", \"Patel\", \"Karnam\", \"Adhikari\", \"Shanbogaru\",\"Patnaik\" etc.) is an administrative government position found in rural parts of the Indian sub-continent. The office and the officeholder are called the \"patwari\" in Telangana, Bengal, North India and in Pakistan while in Sindh it is called \"tapedar\". The position is known as the \"karnam\" in Andhra Pradesh, \"patnaik\" in Orissa or \"adhikari\" in Tamil Nadu, while it is commonly known as the \"talati\" in Karnataka, Gujarat and Maharashtra. The position was known as the \"kulkarni\" in Northern Karnataka and Maharashtra. The position was known as the \"shanbogaru\" in South Karnataka."}, {"idx": 3, "title": "A Kiss for Corliss", "paragraph_text": "A Kiss for Corliss is a 1949 American comedy film directed by Richard Wallace and written by Howard Dimsdale. It stars Shirley Temple in her final starring role as well as her final film appearance. It is a sequel to the 1945 film \"Kiss and Tell\". \"A Kiss for Corliss\" was retitled \"Almost a Bride\" before release and this title appears in the title sequence. The film was released on November 25, 1949, by United Artists."}, {"idx": 4, "title": "Charles Craft", "paragraph_text": "Charles Craft (May 9, 1902 \u2013 September 19, 1968) was an English-born American film and television editor. Born in the county of Hampshire in England on May 9, 1902, Craft would enter the film industry in Hollywood in 1927. The first film he edited was the Universal Pictures silent film, \"Painting the Town\". Over the next 25 years, Craft would edit 90 feature-length films. In the early 1950s he would switch his focus to the small screen, his first show being \"Racket Squad\", from 1951\u201353, for which he was the main editor, editing 93 of the 98 episodes. He would work on several other series during the 1950s, including \"Meet Corliss Archer\" (1954), \"Science Fiction Theatre\" (1955\u201356), and \"Highway Patrol\" (1955\u201357). In the late 1950s and early 1960s he was one of the main editors on \"Sea Hunt\", starring Lloyd Bridges, editing over half of the episodes. His final film work would be editing \"Flipper's New Adventure\" (1964, the sequel to 1963's \"Flipper\". When the film was made into a television series, Craft would begin the editing duties on that show, editing the first 28 episodes before he retired in 1966. Craft died on September 19, 1968 in Los Angeles, California."}, {"idx": 5, "title": "Meet Corliss Archer", "paragraph_text": "Meet Corliss Archer, a program from radio's Golden Age, ran from January 7, 1943 to September 30, 1956. Although it was CBS's answer to NBC's popular \"A Date with Judy\", it was also broadcast by NBC in 1948 as a summer replacement for \"The Bob Hope Show\". From October 3, 1952 to June 26, 1953, it aired on ABC, finally returning to CBS. Despite the program's long run, fewer than 24 episodes are known to exist."}, {"idx": 6, "title": "Shirley Temple", "paragraph_text": "Shirley Temple Black (April 23, 1928 \u2013 February 10, 2014) was an American actress, singer, dancer, businesswoman, and diplomat who was Hollywood's number one box-office draw as a child actress from 1935 to 1938. As an adult, she was named United States ambassador to Ghana and to Czechoslovakia and also served as Chief of Protocol of the United States."}, {"idx": 7, "title": "Kiss and Tell (1945 film)", "paragraph_text": "Kiss and Tell is a 1945 American comedy film starring then 17-year-old Shirley Temple as Corliss Archer. In the film, two teenage girls cause their respective parents much concern when they start to become interested in boys. The parents' bickering about which girl is the worse influence causes more problems than it solves."}, {"idx": 8, "title": "Lord High Treasurer", "paragraph_text": "The post of Lord High Treasurer or Lord Treasurer was an English government position and has been a British government position since the Acts of Union of 1707. A holder of the post would be the third-highest-ranked Great Officer of State, below the Lord High Steward and the Lord High Chancellor."}, {"idx": 9, "title": "Secretary of State for Constitutional Affairs", "paragraph_text": "The office of Secretary of State for Constitutional Affairs was a British Government position, created in 2003. Certain functions of the Lord Chancellor which related to the Lord Chancellor's Department were transferred to the Secretary of State. At a later date further functions were also transferred to the Secretary of State for Constitutional Affairs from the First Secretary of State, a position within the government held by the Deputy Prime Minister."}

# Please adhere strictly to the following response format.
# The format of your response is: 
# Answer: [Your answer]
# Evidence and explanation:[Your Evidence and explanation]
# Step-by-step reasoning with evidence and explanation: [Your Step-by-step reasoning with evidence and explanation]
'''

CoT_prompt = '''
# You are a text Question-Answer agent. Given a context and a claim, please give a Answer to the claim based on the context.
# The format of the answer is {number or date or text}
#  Think step by step to come out the answer.

Question: What science fantasy young adult series, told in first person, has a set of companion books narrating the stories of enslaved worlds and alien species?
Supporting Contexts: {"idx": 0, "title": "Etiquette &amp; Espionage", "paragraph_text": "Etiquette & Espionage is a young adult steampunk novel by Gail Carriger. It is her first young adult novel, and is set in the same universe as her bestselling Parasol Protectorate adult series.", "is_supporting": false}, {"idx": 1, "title": "List of Square Enix companion books", "paragraph_text": "Dozens of Square Enix companion books have been produced since 1998, when video game developer Square began to produce books that focused on artwork, developer interviews, and background information on the fictional worlds and characters in its games rather than on gameplay details. The first series of these books was the \"Perfect Works\" series, written and published by Square subsidiary DigiCube. They produced three books between 1998 and 1999 before the line was stopped in favor of the \"Ultimania\" (\u30a2\u30eb\u30c6\u30a3\u30de\u30cb\u30a2 , Arutimania ) series, a portmanteau of ultimate and mania. This series of books is written by Studio BentStuff, which had previously written game guides for Square for \"Final Fantasy VII\". They were published by DigiCube until the company was dissolved in 2003. Square merged with video game publisher Enix on April 1, 2003 to form Square Enix, which resumed publication of the companion books.", "is_supporting": false}, {"idx": 2, "title": "Victoria Hanley", "paragraph_text": "Victoria Hanley is an American young adult fantasy novelist. Her first three books, \"The Seer And The Sword\", \"The Healer's Keep\" and \"The Light Of The Oracle\" are companion books to one another. Her newest book (released March 2012) is the sequel of a series, called \"Indigo Magic\", published by Egmont USA. She's also published two non-fiction books through Cotton Wood Press; called \"Seize the Story: A Handbook For Teens Who Like To Write\", and \"Wild Ink: A Grownups Guide To Writing Fiction For Teens\".", "is_supporting": false}, {"idx": 3, "title": "Science Fantasy (magazine)", "paragraph_text": "Science Fantasy, which also appeared under the titles Impulse and SF Impulse, was a British fantasy and science fiction magazine, launched in 1950 by Nova Publications as a companion to Nova's \"New Worlds\". Walter Gillings was editor for the first two issues, and was then replaced by John Carnell, the editor of \"New Worlds\", as a cost-saving measure. Carnell edited both magazines until Nova went out of business in early 1964. The titles were acquired by Roberts & Vinter, who hired Kyril Bonfiglioli to edit \"Science Fantasy\"; Bonfiglioli changed the title to \"Impulse\" in early 1966, but the new title led to confusion with the distributors and sales fell, though the magazine remained profitable. The title was changed again to \"SF Impulse\" for the last few issues. \"Science Fantasy\" ceased publication the following year, when Roberts & Vinter came under financial pressure after their printer went bankrupt.", "is_supporting": false}, {"idx": 4, "title": "The Divide trilogy", "paragraph_text": "The Divide trilogy is a fantasy young adult novel trilogy by Elizabeth Kay, which takes place in an alternate universe. The three books are \"The Divide\" (2002), \"Back to The Divide\" (2005), and \"Jinx on The Divide\" (2006). The first novel was originally published by the small press publisher Chicken House (now a division of Scholastic), with subsequent volumes published by Scholastic, which also reprinted the first novel. The books have been translated into French, German, Spanish, Finnish, Chinese, Japanese, Portuguese, Italian, Romanian and Dutch. Interior illustrations are by Ted Dewan.", "is_supporting": false}, {"idx": 5, "title": "Andre Norton Award", "paragraph_text": "The Andre Norton Award for Young Adult Science Fiction and Fantasy is an annual award presented by the Science Fiction and Fantasy Writers of America (SFWA) to the author of the best young adult or middle grade science fiction or fantasy book published in the United States in the preceding year. It is named to honor prolific science fiction and fantasy author Andre Norton (1912\u20132005), and it was established by then SFWA president Catherine Asaro and the SFWA Young Adult Fiction committee and announced on February 20, 2005. Any published young adult or middle grade science fiction or fantasy novel is eligible for the prize, including graphic novels. There is no limit on word count. The award is presented along with the Nebula Awards and follows the same rules for nominations and voting; as the awards are separate, works may be simultaneously nominated for both the Andre Norton award and a Nebula Award.", "is_supporting": false}, {"idx": 6, "title": "The Hork-Bajir Chronicles", "paragraph_text": "The Hork-Bajir Chronicles is the second companion book to the \"Animorphs\" series, written by K. A. Applegate. With respect to continuity within the series, it takes place before book #23, \"The Pretender\", although the events told in the story occur between the time of \"The Ellimist Chronicles\" and \"The Andalite Chronicles\". The book is introduced by Tobias, who flies to the valley of the free Hork-Bajir, where Jara Hamee tells him the story of how the Yeerks enslaved the Hork-Bajir, and how Aldrea, an Andalite, and her companion, Dak Hamee, a Hork-Bajir, tried to save their world from the invasion. Jara Hamee's story is narrated from the points of view of Aldrea, Dak Hamee, and Esplin 9466, alternating in similar fashion to the \"Megamorphs\" books.", "is_supporting": true}, {"idx": 7, "title": "Shadowshaper", "paragraph_text": "Shadowshaper is a 2015 American urban fantasy young adult novel written by Daniel Jos\u00e9 Older. It follows Sierra Santiago, an Afro-Boricua teenager living in Brooklyn. She is the granddaughter of a \"shadowshaper\", or a person who infuses art with ancestral spirits. As forces of gentrification invade their community and a mysterious being who appropriates their magic begins to hunt the aging shadowshapers, Sierra must learn about her artistic and spiritual heritage to foil the killer.", "is_supporting": false}, {"idx": 8, "title": "Animorphs", "paragraph_text": "Animorphs is a science fantasy series of young adult books written by Katherine Applegate and her husband Michael Grant, writing together under the name K. A. Applegate, and published by Scholastic. It is told in first person, with all six main characters taking turns narrating the books through their own perspectives. Horror, war, dehumanization, sanity, morality, innocence, leadership, freedom and growing up are the core themes of the series.", "is_supporting": true}, {"idx": 9, "title": "Left Behind: The Kids", "paragraph_text": "\"Left Behind: The Kids (stylized as LEFT BEHIND >THE KIDS<)\" is a series written by Jerry B. Jenkins, Tim LaHaye, and Chris Fabry. The series consists of 40 short novels aimed primarily at the young adult market based on the adult series Left Behind also written by Jerry B. Jenkins. It follows a core group of teenagers as they experience the rapture and tribulation, based on scriptures found in the Bible, and background plots introduced in the adult novels. Like the adult series, the books were published by Tyndale House Publishing, and released over the 7 year period of 1997-2004. The series has sold over 11 million copies worldwide.", "is_supporting": false}

# Please adhere strictly to the following response format.
# The format of your response is: 
Answer: [Your answer]
Step-by-step reasoning: [Your Step-by-step reasoning ]
'''
try:
    completion = client.chat.completions.create(
        model="gpt-3.5-turbo-16k",
        messages=[
            {"role": "system", "content": E2G_prompt},
        ],
        temperature=0,
        max_tokens=1000,
        top_p=1,
        frequency_penalty=0,
        presence_penalty=0,
    )
    response = completion.choices[0].message.content.strip()
    print(f"RESPONSE:\n" + response)
    resp_text_list = response.split("\n")
    filtered_list = [element for element in resp_text_list if element.strip()]

except Exception as e:
    print(e)
    sleep(1)
